# Hydrofabric usage

We are using flat files generated by the HFsubset endpoint prior to RnR being run. The HFsubset endpoint, similar to T-Route, is managed by the following compose entry:
```yaml
  hfsubset:
    image: ghcr.io/taddyb33/hfsubset-legacy:0.0.4
    ports:
      - "8008:8000"
    volumes:
      - type: bind
        source: ./data/rfc_geopackage_data
        target: /app/data
    command: sh -c ". /app/.venv/bin/activate && uvicorn src.hfsubset.app.main:app --host 0.0.0.0 --port 8000"
    healthcheck:
      test: curl --fail -I http://localhost:8000/health || exit 1
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 5s
```

## What is its job?

Hfsubset is used to create subsets of the hydrofabric v20.1 geopackages that end at a specified location. We make both upstream RFC and downstream RFC subsets, then use them for determining catchments of origin, connectivity, etc. These flat files are fed to T-route using a shared volume. 

## How is this accessed

Subsets are generated by the following localhost endpoints on localhost:8008/docs:
- /api/v1/subset/
- /api/v1/downstream

If you want the whole dataset, you can ping the following endpoint from localhost:8000/docs:
- /api/v1/rfc/build_rfc_geopackages