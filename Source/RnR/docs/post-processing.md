# Post Processing

Post processing is performed on all t-route outputs to include required metadata. 

## What metadata is added:

Outside what is generated by T-Route, and stage, we are adding the following metadata

```python
ds = ds.assign_attrs(assimilated_rfc_point=assimilated_point)
ds = ds.assign_attrs(
    observed_flood_status=json_data["status"]["observed"]["floodCategory"]
)
ds = ds.assign_attrs(
    forecasted_flood_status=json_data["status"]["forecast"]["floodCategory"]
)
ds = ds.assign_attrs(RFC_location_id=json_data["lid"])
ds = ds.assign_attrs(upstream_RFC_location_id=json_data["upstream_lid"])
ds = ds.assign_attrs(downstream_RFC_location_id=json_data["downstream_lid"])
ds = ds.assign_attrs(RFC=json_data["rfc"]["abbreviation"])
ds = ds.assign_attrs(WFO=json_data["wfo"]["abbreviation"])
ds = ds.assign_attrs(USGS=json_data["usgs_id"])
ds = ds.assign_attrs(county=json_data["county"])
ds = ds.assign_attrs(state=json_data["state"]["abbreviation"])
ds = ds.assign_attrs(Latitude=json_data["latitude"])
ds = ds.assign_attrs(Longitude=json_data["longitude"])
ds = ds.assign_attrs(Last_Forecast_Time=json_data["times"][stage_idx])
```

## How is this accessed

The consumer app calls the post processing when running the ReplaceAndRoute service. 