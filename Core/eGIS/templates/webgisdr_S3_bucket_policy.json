{

    "Version": "2012-10-17",

    "Statement": [

        {

            "Sid": "DenyAnythingNotKMSIfExistsOtherwiseEnforceDefaultEncryption",

            "Effect": "Deny",

            "Principal": "*",

            "Action": "s3:PutObject",

            "Resource": "${bucket_arn}/*",

            "Condition": {

                "StringNotEqualsIfExists": {

                    "s3:x-amz-server-side-encryption": "aws:kms"

               },

                "Null": {

                    "s3:x-amz-server-side-encryption": "false"

                }

            }

        },

        {

            "Sid": "DenyIfPassedAnythingNotMatchingThisKMSKey",

            "Effect": "Deny",

            "Principal": "*",

            "Action": "s3:PutObject",

            "Resource": "${bucket_arn}/*",

            "Condition": {

                "StringNotEqualsIfExists": {

                    "s3:x-amz-server-side-encryption-aws-kms-key-id": "${kms_key_id}"

                }

            }

        },
		 {
            "Effect": "Allow",
			"Principal": {
        "AWS": "${access_principal_arns}"
      },
            "Action": [
                "s3:GetBucketPolicy",
                "s3:GetBucketAcl",
                "s3:GetObject",
                "s3:ListBucket",
                "s3:DeleteObject",
                "s3:PutObjectAcl",
				"s3:PutObject",
				"s3:GetBucketLocation",
                "s3:DeleteObjectTagging",
                "s3:PutBucketTagging",
                "s3:PutObjectTagging"
            ],
            "Resource": [
                "${bucket_arn}/*",
                "${bucket_arn}/*"
            ]
		}
    ]
}